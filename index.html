<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Design Automation</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Design Automation</h1>
					<P></P>
					<P></P>
					<h3>梁晓冬</h3>
					<P></P>
					<h6>开发顾问,DevTech中国区经理</h6>					 
					<P></P>
					<h6>开发技术支持部(DevTech)</h6>	
					<h6>Autodesk Forge & ADN </h6>	
 				</section>

				<section>
					<h2>内容</h2>
					<p>
						<ul>
						<li>Design Automation简介</li>
						<li>回顾AutoCAD的AcCoreConsole</li>
						<li>申请开发KEY</li>
						<li>API接口演示和练习</li>
						<li>.NET 库以及演示</li>
						<li>练习和技术交流</li>
					</ul>
					</p>
				</section>
				
				<section>
					<h2>引言 - 技术背景</h2>
					<section id="techbackground">
						 <img width="500" height="500" data-src="images/datacenter.png" alt="Down arrow">					
					</section>	

					<section id="techbackground">
						 <img width="900" height="500" data-src="images/forgemicroservice.png" alt="Down arrow">				
					</section> 
				</section>


				<section>
					<h2>Design Automation简介</h2>
					<p>
						<ul>							 
							<li>云端的自动化设计</li>
							<li>以前叫做< product >.I/O</li>
							<li>只需要参数，命令脚本，原图纸或图纸模板</li>
							<li>一种服务</li> 
								<ul>
								<li>无需安装软件</li>								 
								<li>无需硬件投入和维护</li>
								</ul>
							<li>目前发布AutoCAD的Design Automation</li>
							<li>未来计划：Inventor，Revit，Fusion，Maya等</li>													 
						</ul>
					</p>
				</section>

				<section>

					<section id="autocadDAintro">
						<h2>Design Automation - AutoCAD</h2>

						  <ul>
							<li>可加载 ‘CRX’ 插件，执行自定义命令</li>								 
							<li>CRX，DBX ，.NET ，LISP</li>	
							<li>最新数据:日处理量5万DWG</li>									 
							<li>最新数据:运行无故障时间， 过去的一年: 99.99%</li>							 
					 	</ul>				
					</section> 

					<section id="autocadDAintro">
						<h2>Design Automation原理图</h2>
						<img width="800" height="500" data-src="images/DAWorkflow.png" alt="Down arrow">			
					</section>  
				</section>
 

				<section>
					<h2>客户群</h2>					 
					<ul>							
							<li>不是最终该用户直接使用的</li>
								<ul>
								<li>为开发者而诞生</li>								 								 
								</ul>
							<li>不能交互式编辑DWG图纸</li>
								<ul>
								<li>交互编辑或查看DWG用AutoCAD 360 Web或Mobile版</li>			 								 
							</ul>
							<li>不是服务器</li>
								<ul>
								<li>没有所谓’安装‘</li> 
							</ul> 
					</ul>	
				</section> 
				
				<section>
					<h2>回顾AutoCAD的AcCoreConsole</h2>
					<p>
						<ul>
							<li>AutoCAD 2013引入</li>
							<li>控制台 AutoCAD，无头CAD</li>
							<li>DOS 命令行执行AutoCAD命令</li>
								<ul>
								<li>在图纸上运行一段脚本</li>								 
								<li>快速批处理DWG文件</li>
								</ul>
							<li>可加载’DBX’</li>
							<li>可加载 ‘CRX’ 插件，执行自定义命令</li>
								<ul>
								<li>ObjectARX ，.NET ，LISP</li>								 								 
								</ul>
							<li><a href="http://blog.csdn.net/autodeskinventorapi/article/details/45074629">更多阅读</a></li>
						</ul>
					</p>
				</section>  
				 
				<section>
					<h2>接口概览</h2>					 
					<ul>							
							<li><a href="http://www.odata.org/">OData</a>协议规范（URL 和 payloads）</li>								 
							<li>主要术语，3个集合</li>
								<ul>
									<li>WorkItem</li>
									<li>Activity</li> 
									<li>AppPackage</li>		 
								</ul>
							<li>和客户端用什么语言无关，只要能发送 HTTP请求</li> 
							<img width="800" height="400" data-src="images/DAelement.png" alt="Down arrow">	
							
							<li><a href="https://developer.autodesk.com/en/docs/design-automation/v2/overview/">帮助入口</a></li>					
							
					</ul>	
				</section> 
	
				
				<section>
					<section id="applykey">
						<h2>申请开发key</h2>
						<p>登陆<a href="http://developer.autodesk.com/">http://developer.autodesk.com/</a> </p>
						<p class="applykeyfragment">1. 创建一个APP</p>
						<p ><img width="300" height="150" data-src="images/createapp.png" alt="Down arrow"></p>								
						<p class="applykeyfragment">2. 选择APP服务为AutoCAD I/O </p>
						<p ><img width="600" height="150" data-src="images/chooseservice.png" alt="Down arrow"></p>						
					</section>	

					<section id="applykey">
						<h2>申请开发key</h2>
						<ul>	
							<p>3. 填写APP的基本信息</p>						
							<li>必填APP名</li>	
							<li>选填描述，回调URL和程序网站</li>								 
						</ul>		
						<p ><img width="500" height="400" data-src="images/key.png" alt="Down arrow"></p>								  
					</section>							
				</section> 
				
				
				
				<section>
					<h2><a href="https://www.getpostman.com/collections/xxxxx">PostMan Collection </a><h2>
					<font size = "5">https://www.getpostman.com/collections/1ad3ff309870f7242c9c</font>
					<p ><img width="600" height="600" data-src="images/postman.png" alt="Down arrow"></p>	
				</section>
				
				
				
				<section>
					<h2>身份认证</h2>			
					<section id="gettoken">
					<li>OAuth2 token</li>  
					<li><a href="https://developer.autodesk.com/en/docs/oauth/v2/reference/http/authenticate-POST/">获取Token (2legged)</a></li>
					</section>
					<section id="gettoken">
					<p ><img width="500" height="400" data-src="images/gettoken.png" alt="Down arrow"></p>	
					</section>
				</section>
				
				<section>
					<h2>Activity和WorkItem</h2>			
					<ul>
						<li>Activity：具体脚本和参数，可以理解为一个功能函数</li>
						<li>WorkItem：计划任务，提供参数。用来调用函数</li>						 
					</ul>		 
					<img width="500" height="300" data-src="images/act-like-fun.png" alt="Down arrow">
					<img width="400" height="300" data-src="images/work-like-fun.png" alt="Down arrow">					 
				</section>
				
				<section>
					<section id="activity">
						<h2>Activity</h2>			
						<ul>							
								<li>定义输入输出参数</li>								 							 
									<ul>
										<li>满足 URL 的参数要求</li> 	 								 
									</ul>
									<P></P>
								<li>计划提供Activities库</li>
									<ul>
									<li>作为AutoCAD专业库</li>								 								 
								</ul> 
								<P></P>
								<li>Activities可以是公开或私有</li>
									<ul>
									<li>可以分享Activities</li>								 								 
								</ul> 
						</ul>
					</section>
					<section id="activity">
					 <h2>Activity</h2>
					 <font size = "5">
					 <ul>	
					 <li>InputParameters: 需要的输入参数</li>	
					 <li>OutputParameters: 输出参数</li>	
					 <li>Instruction: 定义要执行的Script</li>
					 <li>Id: Action的名字</li>
					 <li><a href="https://developer.autodesk.com/en/docs/design-automation/v2/reference/http/Activities-POST/">创建Activity</a></li>

					 </ul>
					 </font> 
					</section>
					<section id="activity">
					 <h2>Activity</h2>	
					 <img width="700" height="500" data-src="images/createact.png" alt="Down arrow"> 
					 </section>
				</section>
				
				<section>
					<section id="workitem">
					<h2>WorkItem</h2>	
									
					<ul>							
							<li>WorkItem需要</li>								 							 
								<ul>
									<li>关联某 ‘Activity’</li> 	 								 
									<li>输入参数 (URLs)</li> 	 								 
									<li>输出参数 (URLs)</li> 	 								 
								</ul>
								<P></P>
							<li>查看WorkItem状态:</li>
								<ul>
								<li>可用状态查询方式</li>								 								 
								<li>也可使用回调URL</li>								 								 								 
							</ul> 
					</ul>	
					</section>
					<section id="workitem">
					<h2>WorkItem</h2>
					<font size = "5">
					 <ul>	
					 <li>InputArguments: 需要的输入参数, 源DWG所在位置</li>	
					 <li>OutputArguments: 输出参数，生成的结果存放位置</li>						  
					 <li>ActivityId: 需要使用哪个Activity</li>
					 <li>不需要设定WorkItem的名字，系统自行分配</li>
					 </ul>		
					</font>		 
					<li><a href="https://developer.autodesk.com/en/docs/design-automation/v2/reference/http/WorkItems-POST/">创建WorkItem</a></li>
					</section>
					<section id="workitem">
					<h2>WorkItem</h2>
					 <img width="700" height="500" data-src="images/workitem.png" alt="Down arrow"> 

					</section>
					
					<section id="workitem">
					<h2>WorkItem 返回值</h2>
					<font size="5">
					<ul> 
						<li>Response.Status: 标示成功，或失败的代码</li>
						<li>Response.OutputArguments.Resource: 结果文件地址，存放在IO租用的亚马逊服务器上</li>
						<li>Response.StatusDetails.Report： 任务日志,查看具体错误的环节</li>
						<img width="700" height="500" data-src="images/workitemreport.png" alt="Down arrow">  
					</ul>
					</font> 

					</section>
					
				</section>

				<section>
					<h2>网盘存储访问方式</h2>
					<font size="5">
					 <ul> 
						<li>直接url</li>
						<ul>
						  <li>例如：http://forge-test.oss-cn-shanghai.aliyuncs.com/TestDemo1.dwg</li>
						  <li>无安全访问控制</li>
						</ul>
						<li>签名url</li>
						  <ul>
						  <li>例如：https://xiaodongforgetest.s3-ap-southeast-1.amazonaws.com/resultxxx.pdf?AWSAccessKeyId=AKIAI5Z2P3BJNALZEA4A&Expires=1472056525&Signature=1jVpbxDCDcClqGz%2FoooflLYX3iQ%3D</li>
						  <li>由网盘的key secret加密计算出上载或下载的url</li>
						  </ul>
						  <li>带header的url</li>
						  <ul>
						  <li>例如： Resource = "http://portalvhdsz7vs58j0h10tp.blob.core.windows.net/test/A-01.pdf?sv=2014-02-14&sr=c&sig=ngiVjMtuQNOWKRZtwosL4va3M7fgg9bt22e6FtH6gEo%3D&st=2015-05-15T07%3A00%3A00Z&se=2018-05-23T07%3A00%3A00Z&sp=rw",
			                Headers = new System.Collections.ObjectModel.ObservableCollection<Header>() 
			                { 
			                    new Header() { Name = "x-ms-blob-type", Value = "BlockBlob" } // This is required for Azure blob.
			                }</li>
						  <li>由网盘的key secret加密计算出上载或下载的url，并且配置HTTP Header添加控制选项</li>
						  </ul>
					</ul>
					</font>

				</section>
	
				<section>
					<section id="applycloud">
							<h2>网盘（以阿里云为例）</h2>
							<ul>	
								<p>1. 登陆<a href = "https://account.aliyun.com/">阿里云</a></p>													 						 
							 							
							</ul>		
							<p ><img width="500" height="400" data-src="images/alilogin.png" alt="Down arrow"></p>								  
					 </section>	
					 <section id="applycloud">
							<h2>网盘（以阿里云为例）</h2>
							<ul>	
								<p>2. 开放存储服务OSS</p>													 						 
							</ul>		
							<p ><img width="500" height="400" data-src="images/alioss.png" alt="Down arrow"></p>								  
					 </section>	
					  <section id="applycloud">
							<h2>网盘（以阿里云为例）</h2>
							<ul>	
								<p>3. 进入bucket testio</p>													 						 
							</ul>		
							<p ><img width="500" height="400" data-src="images/alibucket.png" alt="Down arrow"></p>								  
					 </section>	
					 
					   <section id="applycloud">
							<h2>网盘（以阿里云为例）</h2>
							<ul>	
								<p>4. 上载文件>> 选取某DWG文件</p>													 						 
								<p>5. 获取地址   </p>			
							</ul>		
							<p ><img width="700" height="400" data-src="images/alifile.png" alt="Down arrow"></p>								  
					 </section>	
				 </section> 

				<section>
					<h2>练习：导出PDF</h2>	
					<h2>练习：创建Activity。 命令行设计脚本，提交WorkItem</h2>		 


				</section>

				<section>
					<h2>导出结果文件到其它云存储</h2>	
 <pre><code>
 //设置输出参数
wi.Arguments.OutputArguments.Add(new Argument()
{
    //对应Activity哪个参数 
    Name = "Result",
    //非A360数据源
    StorageProvider = StorageProvider.Generic,
    //HTTP动作 - 将结果放到对应的云存储
    HttpVerb = HttpVerbType.PUT,
    //如果设置为null，则缺省放到Design Automation 存储空间里
    //Resource = null,
     Resource = "https://xiaodongforgetest.s3-ap-southeast-1.amazonaws.com/resultxxx.pdf?AWSAccessKeyId=AKIAI5Z2P3BJNALZEA4A&Expires=1472056525&Signature=1jVpbxDCDcClqGz%2FoooflLYX3iQ%3D",

});
 </code></pre>					

				</section>
				
				<section>
					<h2>外部引用</h2>			
					<ul>							
							<li>DWG 文件可以有外部参照 (dwg, 图片等.)</li>	
							<P></P>							
							<li>客户端必须提供所有引用</li>				
							 <ul>
								<li>网络传输package</li>								 								 
								<li>输入参数提供内联 ‘File’ 对象 (JSON 字串描述URLs和其本地名)</li>	 
								<pre><code>
"Arguments": {
"InputArguments": [
  {
    "Resource": 
            {
              "Resource":"..../Main.dwg",
              "LocalFileName":"Main.dwg",
              "RelatedFiles":[
                    {
                        "Resource":"...../xref.dwg",
                        "LocalFileName":"xref.dwg"
                        
                    }]
            } ,
								</code></pre>
					</ul>			 					  
				</section> 


				<section>
					<h2>练习：提交WorkItem，外部引用</h2>	
 
				</section>

					
				<section>
					<h2>背后发生了什么</h2>			
					<ul>							
							<li>Worker通过队列收取 WorkItem</li>	
							<P></P>							
							<li>下载输入参数</li>
							<ul>
								<li>HTTP GET</li>								
							</ul>
							<li>运行AcCoreConsole.exe</li>
							<P></P>	
							<li>将结果上载到输出参数指定的存储</li>
							<ul>
								<li>HTTP POST/PUT</li>								
							</ul> 							 
					</ul>			 					  
				</section>


			 
				 <section> 

					<section id="netlib">
						<h2>.NET库</h2>
						<font size="5">
						<ul>  
								<li>NuGet >> OData</li>									 
								<img   data-src="images/netreference.png" alt="Down arrow">  
						</ul>
						</font>
					  			   
					</section>
					<section id="netlib">
					   <img  data-src="images/netlibaiott.png" alt="Down arrow"> 
					 </section>

				</section>
				
				<section> 
				  
					<h2>AppPackage </h2>	
					
						<ul>										 
								<li>可上载 .NET或C++ 程序</li>	
								<li>CRX 程序</li>	
								<li>DBX 程序 </li>	
								<li>App 必须打包为<a href = "http://download.autodesk.com/media/adn/ADN_DevCast_Episode_6/ADN_DevCast_Episode_6.html">Autoloader</a>格式</li>	 
						</ul>	 
				
				</section>
				 <section> 
					<section id="AppPackage">
					<h2>AppPackage过程<a href = "data\AutoCADIO_PackageTest.zip">样例下载</a></h2>	
					
						<ul>		
								<font size= "5">
								<li>1. 准备AutoCAD开发程序的bundle的zip包</li>	
								<li>2. 得到上载到package的存储url： Design Automation在亚马逊服务器上的空间</li>	
								<li>3. 将准备好的bundle的zip文件上载到package的存储url </li>	
								<li>4. 创建Package</li>	
								<li>5. 创建Activity和Package关联</li>	
								<li>6. 创建WorkItem执行任务</li>	 
								
								<img width="800" height="400" data-src="images/package.png" alt="Down arrow">  
								</font>
								
						</ul>	
					</section> 
					
					<section id="AppPackage">
						<ul>
						<li>1. 准备AutoCAD开发程序的bundle的zip包</li>	
						<li>PackageContents.xml</li>
						<li>LoadOnAutoCADStartup:  启动时加载</li>
						<li>LoadOnCommandInvocation:  执行自定义命令时按需加载</li>
						</ul> 
					</section> 
					
					<section id="AppPackage">
						<ul>
						<li>2. <a href="https://developer.autodesk.com/en/docs/design-automation/v2/reference/http/AppPackages-Operations.GetUploadUrl-GET/">得到上载package的存储url</a>： Design Automation在亚马逊服务器上的空间</li>	
						</ul> 
					</section> 
					
					<section id="AppPackage">						 	
						<ul>
						<li>3. 将准备好的bundle的zip文件上载package的存储url </li>	
						<li><a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/PresignedUrlUploadObject.html">AWS S3 签名URL规范</a></li>	

						 </ul>
					</section> 
					
					 <section id="AppPackage">						 	
						<ul>
						<li>4. <a href= "https://developer.autodesk.com/en/docs/design-automation/v2/reference/http/AppPackages-POST/">创建Package</a></li>	
						</ul>	 
					</section> 
					
					 			
					 <section id="AppPackage">						 	
						<ul>
					    <li>5. <a herf="https://developer.autodesk.com/en/docs/design-automation/v2/reference/http/Activities-POST/">创建Activity和Package关联</a></li>	
						</ul> 
						
					</section> 
					
					 <section id="AppPackage">						 	
					 	<ul>
						 <li>6. <a herf = "https://developer.autodesk.com/en/docs/design-automation/v2/reference/http/WorkItems-POST/">创建WorkItem执行任务</a></li>	 
						 </ul>
					</section>
					
				</section> 
				 
				
				<section>
					<h2>练习：提交package, 创建workitem</h2>	
 
				</section>

				<section>
					<h2>多种导出内容</h2>	
				 <pre><code>
  //设置输出参数
wi.Arguments.OutputArguments.Add(new Argument()
{
    //对应Activity哪个参数 
    Name = "Result",
    //非A360数据源
    StorageProvider = StorageProvider.Generic,
    //HTTP动作 - 将结果放到对应的云存储
    HttpVerb = HttpVerbType.POST,
    //如果设置为null，则缺省放到Design Automation 存储空间里
    Resource = null

    //测试导出zip
    ,
    ResourceKind = ResourceKind.ZipPackage
});
				 </code></pre>

 
 				<section>
					<h2>练习：修改package, 导出多种参数，创建workitem</h2>	
 
				</section>

				</section>

				<section>
					<h2>多种方式输入参数</h2>	
				 <pre><code>
//设置输入参数
    wi.Arguments.InputArguments.Add(new Argument()
    {
        //嵌入式参数
        Name = "EmbeddedParams",
        ResourceKind = ResourceKind.Embedded,
        //来源。      
        Resource = @"data:application/json, " + "{\"centerX\":100,\"centerY\":100,\"radius\":500}",
        //非A360数据源
        StorageProvider = StorageProvider.Generic
    });
    //设置输入参数
    wi.Arguments.InputArguments.Add(new Argument()
    {
        //外链参数
        Name = "LinkedParams",
        //来源    
        Resource = "http://forge-xd-generic-test.herokuapp.com/downloadDADrawing/LinkedParams.json",
        //非A360数据源
        StorageProvider = StorageProvider.Generic
    });
				 </code></pre>

 
				</section>


 				<section>
					<h2>练习：创建package, 构建多种输入参数，创建workitem</h2>	
 
				</section>
 



				<section data-transition="slide" data-background="#317f65" data-background-transition="zoom">
					<h1>综合例子演示</h1>   
					<li><a href="https://github.com/Developer-Autodesk/design.automation-asp.net-cabinet-sample">抽屉定制设计</a></li>
					<li><a href="https://github.com/xiaodongliang/ViewData-DWG-TitleBlock-Signature/">标题栏签名</a></li>
	
					<li><a href="https://github.com/KeanW/jigsawify">拼图DWG生成器</a></li>
					<li><a href="https://github.com/xiaodongliang/design.automation-data.management-jigsaw.sample">拼图DWG生成器升级版</a></li>		
		
				</section>    
				<section>
					 <img width="800" height="600" data-src="images/Autodesk.png" alt="Down arrow">	
				</section>  
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
